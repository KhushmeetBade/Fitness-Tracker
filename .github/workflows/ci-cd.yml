name: CI-CD Simulation

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build_and_test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    # Detect File Changes
    - name: Detect Changed Files
      id: changes
      run: |
        echo "== Files Changed in this Commit =="
        git show --name-only --pretty=""
        echo "---"

        if git show --name-only HEAD | grep -q "App.java"; then
          echo "App.java updated ðŸŽ‰";
        fi
        
        if git show --name-only HEAD | grep -q "Test"; then
          echo "Test cases modified ðŸ§ª";
        fi

        if git show --name-only HEAD | grep -q ".java"; then
          echo "Java source updated ðŸ”¥";
        fi
        
        if git show --name-only HEAD | grep -q "README.md"; then
          echo "Documentation updated ðŸ“„";
        fi
        
        if git show --name-only HEAD | grep -q "pom.xml"; then
          echo "Dependencies/configs updated ðŸ“¦";
        fi

    # Build Stage
    - name: Build Project with Maven
      run: mvn -B package --file pom.xml

    # Test Stage
    - name: Run Unit Tests
      run: mvn test

    # Simulated Deploy
    - name: Deployment Step (Simulation)
      run: echo "ðŸš€ Deployment simulated successfully"
